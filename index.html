<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#d86b4a" />

  <title>幸福教養｜模組1 大人先穩</title>

  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" href="./圖示/icon-192.png" />
  <link rel="apple-touch-icon" href="./圖示/icon-192.png" />

  <link rel="stylesheet" href="./styles.css" />
</head>
<body>

  <div class="app">
    <header class="top">
      <div class="brand">
        <div class="kicker">幸福教養｜不打不罵不氣</div>
        <h1>模組 1｜大人先穩</h1>
        <p class="sub">不用威嚇｜以愛連結｜先穩住，再說</p>

        <!-- ✅ 安裝提示（含 icon） -->
        <div class="install-hint" id="installHint">
          <img src="./圖示/icon-512.png" alt="App icon" class="install-icon" />
          <div class="install-text">
            <div class="install-title">📱 建議安裝使用</div>
            <div class="install-line">安卓／三星：Chrome 或 三星網路 →「加入主畫面」</div>
            <div class="install-line">iPhone：Safari →「分享」→「加入主畫面」</div>
            <div class="install-actions">
              <button class="btn miniBtn" id="btnShowInstallGuide" type="button">看安裝教學</button>
            </div>
          </div>
        </div>
      </div>

      <div class="right">
        <div class="selectors">
          <div class="ageBar">
            <label class="ageLabel">孩子年齡：</label>
            <select id="ageGroup" class="ageSelect">
              <option value="preschool">幼兒（3–6）</option>
              <option value="elementary" selected>小學（6–12）</option>
              <option value="teen">青春期（12+）</option>
            </select>
          </div>

          <div class="ctxBar">
            <label class="ctxLabel">現在情境：</label>
            <div class="ctxRow" role="group" aria-label="情境切換">
              <button class="ctx active" data-ctx="home">🏠 家裡</button>
              <button class="ctx" data-ctx="out">🚶 外出</button>
              <button class="ctx" data-ctx="night">🌙 睡前</button>
            </div>
          </div>
        </div>

        <div class="quick">
          <!-- ✅ Android 可用的安裝按鈕（beforeinstallprompt 才會顯示） -->
          <button class="btn primary installBtn" id="btnInstall" hidden>安裝到桌面</button>

          <button class="btn primary" id="btnOpenRescue">我快撐不住了（急救）</button>
          <button class="btn ghost" id="btnStop">停止</button>
        </div>
      </div>
    </header>

    <nav class="tabs" role="tablist" aria-label="Module 1 Tabs">
      <button class="tab active" data-tab="t0" role="tab" aria-selected="true">整合流程</button>
      <button class="tab" data-tab="t1" role="tab" aria-selected="false">穩定語錨點</button>
      <button class="tab" data-tab="t2" role="tab" aria-selected="false">角色回位</button>
      <button class="tab" data-tab="t3" role="tab" aria-selected="false">安全延後</button>
      <button class="tab" data-tab="t4" role="tab" aria-selected="false">等待位</button>
      <button class="tab" data-tab="t5" role="tab" aria-selected="false">錦囊妙計（急救）</button>
      <button class="tab" data-tab="t6" role="tab" aria-selected="false">微練功</button>
      <button class="tab" data-tab="t7" role="tab" aria-selected="false">每日自評</button>
    </nav>

    <!-- 急救浮層 -->
    <section class="overlay" id="overlay" aria-hidden="true">
      <div class="overlayCard">
        <div class="overlayTop">
          <div>
            <div class="overlayTitle">60 秒急救｜跟著做</div>
            <div class="muted small" id="rescueMeta">年齡：小學｜情境：家裡</div>
          </div>
          <button class="x" id="btnClose" aria-label="關閉">✕</button>
        </div>

        <div class="countdown">
          <div class="countNum" id="countNum">60</div>
          <div class="bar"><span id="countBar"></span></div>
        </div>
        <div class="muted mini" id="countHint">現在只要撐完這 1 分鐘。先不要講道理。</div>

        <div class="breath">
          <div class="ring" id="ring"></div>
          <div class="cue" id="cue">按「開始急救」跟著呼吸</div>
        </div>

        <div class="lineBox">
          <div class="label">可照念一句話（會依年齡 × 情境建議，可自訂）</div>
          <div class="quote" id="defaultLine">「我現在需要先穩一下，等一下我們再說。」</div>
          <div class="mini" id="tipHint">提醒：同理＋界線＋承諾</div>

          <div class="overlayBtns">
            <button class="btn primary" id="btnStartRescue">開始急救</button>
            <button class="btn ghost" id="btnCopyDefault">複製這句</button>
          </div>
        </div>

        <div class="overlayBtns bottom">
          <button class="btn ghost" id="btnStopRescue">停止急救</button>
          <button class="btn ghost" id="btnClose2">關閉</button>
        </div>
      </div>
    </section>

    <main class="panels">
      <!-- 0 -->
      <section class="panel active" id="t0" role="tabpanel">
        <div class="card">
          <h2>整合流程（現場照走）</h2>
          <p class="muted">你只要做對順序，就會穩。不是完美，是可重複。</p>

          <ol class="flow">
            <li><span class="dot">1</span> 刺激出現（孩子哭/吵/頂嘴/失控）</li>
            <li><span class="dot">2</span> <strong>先穩住，再說</strong>（呼吸 4/6 × 2）</li>
            <li><span class="dot">3</span> <strong>我是教養者，不是對手</strong>（角色回位）</li>
            <li><span class="dot">4</span> <strong>安全延後語句</strong>（不在高張力談）</li>
            <li><span class="dot">5</span> <strong>孩子安全等待位</strong>（給落點、關係不斷線）</li>
            <li><span class="dot">6</span> 回來處理（界線/合作/修復）</li>
          </ol>

          <div class="ctaRow">
            <button class="btn primary" data-jump="t5">先準備「錦囊妙計（急救）」</button>
            <button class="btn ghost" data-jump="t1">從穩定語錨點開始</button>
          </div>
        </div>

        <div class="card soft">
          <h3>你的「預設救場句」（可自訂）</h3>
          <p class="muted">會顯示在急救浮層，也會被「錦囊急救」套用。</p>
          <div class="setting">
            <input id="favLine" class="input" placeholder="例：我先穩一下，等一下再談" />
            <button class="btn primary" id="saveFav">儲存</button>
            <button class="btn ghost" id="resetFav">恢復建議</button>
          </div>
          <div class="mini muted">若你不自訂，會依「年齡 × 情境」自動套用建議句。</div>
        </div>
      </section>

      <!-- 1 -->
      <section class="panel" id="t1" role="tabpanel">
        <div class="card">
          <h2>工具 1-1｜穩定語錨點</h2>
          <p class="muted">先把自己拉回線上，才不會用情緒處理孩子。</p>

          <div class="big">先穩住，再說</div>

          <div class="grid">
            <div class="miniCard">
              <div class="miniTitle">身體（10 秒）</div>
              <ul>
                <li>吸 4 秒、吐 6 秒 × 2</li>
                <li>腳踩地，感覺重量</li>
                <li>放下肩膀</li>
              </ul>
            </div>
            <div class="miniCard">
              <div class="miniTitle">嘴巴（先不做）</div>
              <ul>
                <li>先不講道理</li>
                <li>先不質問</li>
                <li>先不定罪</li>
              </ul>
            </div>
          </div>

          <div class="quoteSet">
            <div class="label">一鍵句（點一下＝複製＋套入急救句）</div>
            <button class="chip" data-say="先穩住，再說。">先穩住，再說。</button>
            <button class="chip" data-say="我先呼吸兩次，再處理。">我先呼吸兩次，再處理。</button>
            <button class="chip" data-say="我可以穩住，我等一下再說。">我可以穩住，我等一下再說。</button>
          </div>
        </div>
      </section>

      <!-- 2 -->
      <section class="panel" id="t2" role="tabpanel">
        <div class="card">
          <h2>工具 1-2｜角色回位卡</h2>
          <p class="muted">你的角色不是「贏」，而是「帶孩子回安全」。</p>

          <div class="big">我是教養者，不是對手</div>

          <div class="grid">
            <div class="miniCard">
              <div class="miniTitle">自問 2 秒</div>
              <ul>
                <li>我現在是想「教」？還是想「贏」？</li>
                <li>我是在保護關係？還是在輸出情緒？</li>
              </ul>
            </div>
            <div class="miniCard">
              <div class="miniTitle">回位一句</div>
              <ul>
                <li>「我先回到大人的位置。」</li>
                <li>「我可以清楚，也可以溫柔。」</li>
              </ul>
            </div>
          </div>

          <div class="quoteSet">
            <div class="label">一鍵句（點一下＝複製＋套入急救句）</div>
            <button class="chip" data-say="我先回到大人的位置。">我先回到大人的位置。</button>
            <button class="chip" data-say="我不跟你吵，我會帶你回安全。">我不跟你吵，我會帶你回安全。</button>
            <button class="chip" data-say="我是教養者，不是對手。">我是教養者，不是對手。</button>
          </div>
        </div>
      </section>

      <!-- 3 -->
      <section class="panel" id="t3" role="tabpanel">
        <div class="card">
          <h2>工具 1-3｜安全延後語句</h2>
          <p class="muted">延後不是逃避，是為了不在高張力談重要的事。</p>

          <div class="big">先停一下，等我穩好再談</div>

          <div class="quoteSet">
            <div class="label">一鍵延後（點一下＝複製＋套入急救句）</div>
            <button class="chip" data-say="我知道你很難受，現在我們先不談，等我穩好再一起處理。">
              我知道你很難受…等我穩好再一起處理
            </button>
            <button class="chip" data-say="這件事很重要，我不想用生氣處理，我們等一下再說。">
              這件事很重要…我不想用生氣處理
            </button>
            <button class="chip" data-say="我在，我沒有不要你。我先穩一下，等一下回來。">
              我在…我沒有不要你…等一下回來
            </button>
          </div>

          <div class="miniCard">
            <div class="miniTitle">結構（你就記這個）</div>
            <ol>
              <li>我看見你（同理）</li>
              <li>我需要先穩（界線）</li>
              <li>我會回來（承諾）</li>
            </ol>
          </div>
        </div>
      </section>

      <!-- 4 -->
      <section class="panel" id="t4" role="tabpanel">
        <div class="card">
          <h2>工具 1-4｜孩子安全等待位</h2>
          <p class
